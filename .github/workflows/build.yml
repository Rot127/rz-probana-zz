# SPDX-FileCopyrightText: 2023 Rot127 <unisono@quyllur.org>
# SPDX-License-Identifier: LGPL-3.0-only

name: Build and Test

on: [push, pull_request]

env:
  CARGO_TERM_COLOR: always

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Set up Python 3.x
      uses: actions/setup-python@v4
      with:
        python-version: '3.x'
    - name: Set env variable
      run: |
        echo "RZ_INSTALL_ROOT_PATH=$HOME/root/" >> $GITHUB_ENV
        echo "RZ_REPO_PATH=$HOME" >> $GITHUB_ENV
    - name: Install deps
      run: |
          pip3 install meson ninja
    - name: Checkout Rizin
      uses: actions/checkout@v4
      with:
        repository: rizinorg/rizin
        path: rizin
    - name: Install Rizin
      run:
          |
        mkdir "$RZ_INSTALL_ROOT_PATH"
        cd rizin
        meson setup build
        meson compile -C build
        meson install -C build --destdir "$RZ_INSTALL_ROOT_PATH"
        cd ..
    - name: Build rz-probana-zz
      run:
        |
        cargo build --verbose
    - name: Run tests
      run:
         |
        cargo test --verbose

